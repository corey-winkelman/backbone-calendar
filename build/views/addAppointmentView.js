define(["backbone","handlebars","models/appointmentModel","collections/appointmentsCollection","views/appointmentView","views/appointmentsView","text!templates/addAppointmentTemplate.html"],function(e,t,n,r,i,s,o){return Calendar.Views.AddAppointmentView=e.View.extend({className:"add-appointment",template:t.compile(o),initialize:function(){},events:{"click .submit":"createAppointment","click .close":"close"},render:function(){return this.$el.html(this.template()),this.$submit=this.$(".submit"),this.$title=this.$(".new-appt-title"),this.$description=this.$(".new-appt-description"),this},positionForm:function(e){this.target=e,this.date=e.model.date;var t=0,n=0,t=e.$el.outerHeight(),n=e.$el.outerWidth(),r=$(".add-appointment").outerWidth(),i=$(".add-appointment").outerHeight(),s=e.$el.offset().left+n/2-r/2,o=e.$el.offset().top-t/2-i/2;o<$(window).scrollTop()&&(o=e.$el.offset().top-t/2+i/2),$(".add-appointment").css({left:s,top:o})},newAttributes:function(){var e=this.date.getFullYear(),t=this.date.getMonth(),n=this.date.getDate();return t<10&&(t="0"+t.toString()),n<10&&(n="0"+n.toString()),this.dateId=e.toString()+t+n,{date:this.dateId,title:this.$title.val().trim(),description:this.$description.val().trim()}},createAppointment:function(){var e=new n(this.newAttributes());this.target.appointmentsCollection?this.target.appointmentsCollection.create(e):(this.target.appointmentsCollection=new r,this.target.appointmentsCollection.create(e),this.target.appointmentsView=new s({collection:this.target.appointmentsCollection}),this.target.addAppointments(this.target.appointmentsView),this.target.appointmentsCollection.trigger("add:all")),this.close()},close:function(){this.$el.hide(),this.$title.val(""),this.$description.val(""),$(".day.focused").removeClass("focused")}}),Calendar.Views.AddAppointmentView})